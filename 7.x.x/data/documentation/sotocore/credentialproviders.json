{"kind":"article","schemaVersion":{"minor":3,"major":0,"patch":0},"abstract":[{"type":"text","text":"Providing Credentials for signing AWS requests"}],"seeAlsoSections":[{"generated":true,"title":"Articles","identifiers":["doc:\/\/codes.soto.soto-core\/documentation\/SotoCore\/ServiceObjects"],"anchor":"Articles"}],"identifier":{"url":"doc:\/\/codes.soto.soto-core\/documentation\/SotoCore\/CredentialProviders","interfaceLanguage":"swift"},"sections":[],"hierarchy":{"paths":[["doc:\/\/codes.soto.soto-core\/documentation\/SotoCore"]]},"metadata":{"modules":[{"name":"SotoCore"}],"roleHeading":"Article","title":"Credential Providers","role":"article"},"primaryContentSections":[{"content":[{"level":2,"anchor":"overview","type":"heading","text":"Overview"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Before using Soto, you will need AWS credentials to sign all your requests. The main client object, "},{"code":"AWSClient","type":"codeVoice"},{"text":", accepts a ","type":"text"},{"type":"codeVoice","code":"credentialProvider"},{"type":"text","text":" parameter in its "},{"type":"codeVoice","code":"init"},{"text":". With this you can specify how the client should find AWS credentials. The default if you don’t set the ","type":"text"},{"code":"credentialProvider","type":"codeVoice"},{"text":" parameter is to select a method from the four methods listed below. Each method is tested in the order they are listed below and the first that is successful is chosen. If you are running on a Mac it ignores the ECS or EC2 methods as they would obviously fail.","type":"text"}]},{"type":"heading","anchor":"Load-Credentials-from-Environment-Variable","text":"Load Credentials from Environment Variable","level":3},{"type":"paragraph","inlineContent":[{"text":"You can set the environment variables ","type":"text"},{"code":"AWS_ACCESS_KEY_ID","type":"codeVoice"},{"type":"text","text":" and "},{"code":"AWS_SECRET_ACCESS_KEY","type":"codeVoice"},{"type":"text","text":" and "},{"type":"codeVoice","code":"AWSClient"},{"text":" will automatically pick up the credentials from these variables.","type":"text"}]},{"syntax":"bash","code":["AWS_ACCESS_KEY_ID=YOUR_AWS_ACCESS_KEY_ID","AWS_SECRET_ACCESS_KEY=YOUR_AWS_SECRET_ACCESS_KEY"],"type":"codeListing"},{"level":3,"text":"Via ECS Container credentials","anchor":"Via-ECS-Container-credentials","type":"heading"},{"type":"paragraph","inlineContent":[{"text":"If you are running your code as an AWS ECS container task, you can ","type":"text"},{"type":"reference","identifier":"https:\/\/docs.aws.amazon.com\/AmazonECS\/latest\/developerguide\/task-iam-roles.html#create_task_iam_policy_and_role","isActive":true},{"text":" for your container task to automatically grant credentials via the metadata service.","type":"text"}]},{"text":"Via EC2 Instance Profile","anchor":"Via-EC2-Instance-Profile","level":3,"type":"heading"},{"inlineContent":[{"text":"If you are running your code on an AWS EC2 instance, you can ","type":"text"},{"identifier":"https:\/\/docs.aws.amazon.com\/codedeploy\/latest\/userguide\/getting-started-create-iam-instance-profile.html","type":"reference","isActive":true},{"type":"text","text":" as the server’s Instance Profile to automatically grant credentials via the metadata service."}],"type":"paragraph"},{"text":"Load Credentials from shared credential file.","anchor":"Load-Credentials-from-shared-credential-file","level":3,"type":"heading"},{"inlineContent":[{"type":"text","text":"You can "},{"identifier":"https:\/\/docs.aws.amazon.com\/ses\/latest\/DeveloperGuide\/create-shared-credentials-file.html","isActive":true,"type":"reference"},{"text":" in the home directory for the user running the app, in the file ","type":"text"},{"code":"~\/.aws\/credentials","type":"codeVoice"},{"text":".","type":"text"}],"type":"paragraph"},{"syntax":"ini","type":"codeListing","code":["[default]","aws_access_key_id = YOUR_AWS_ACCESS_KEY_ID","aws_secret_access_key = YOUR_AWS_SECRET_ACCESS_KEY"]},{"anchor":"Pass-Credentials-to-AWSClient-directly","level":2,"type":"heading","text":"Pass Credentials to AWSClient directly"},{"type":"paragraph","inlineContent":[{"type":"text","text":"If you would prefer to pass the credentials to the "},{"type":"codeVoice","code":"AWSClient"},{"text":" directly you can specify credentials with the ","type":"text"},{"code":".static","type":"codeVoice"},{"text":" credential provider as follows.","type":"text"}]},{"code":["let client = AWSClient(","    credentialProvider: .static(","        accessKeyId: \"MY_AWS_ACCESS_KEY_ID\",","        secretAccessKey: \"MY_AWS_SECRET_ACCESS_KEY\"","    )",")"],"syntax":"swift","type":"codeListing"},{"anchor":"Without-Credentials","type":"heading","level":2,"text":"Without Credentials"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Some services like CognitoIdentityProvider don’t require credentials to access some of their functionality. In this case you should use the "},{"type":"codeVoice","code":".empty"},{"type":"text","text":" credential provider. This will disable all other credential access functions and send requests unsigned."}]},{"code":["let client = AWSClient(credentialProvider: .empty)"],"type":"codeListing","syntax":"swift"},{"text":"Selector Credential Providers","type":"heading","level":2,"anchor":"Selector-Credential-Providers"},{"type":"paragraph","inlineContent":[{"text":"You can supply a list of credential providers you would like your ","type":"text"},{"type":"codeVoice","code":"AWSClient"},{"text":" to use with the ","type":"text"},{"type":"codeVoice","code":".selector"},{"type":"text","text":" credential provider. Each provider in the list is tested, until it finds a provider that successfully provides credentials. The following would test if credentials are available via environment variables, and then in the shared config file "},{"type":"codeVoice","code":"~\/.aws\/credentials"},{"text":".","type":"text"}]},{"code":["let client = AWSClient(credentialProvider: .selector(.environment, .configfile()))"],"type":"codeListing","syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The default credential provider is implemented as a selector."}]},{"syntax":"swift","type":"codeListing","code":[".selector(.environment, .ecs, .ec2, .configfile())"]},{"type":"heading","text":"STS and Cognito Identity","anchor":"STS-and-Cognito-Identity","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"The "},{"type":"codeVoice","code":"CredentialProviders"},{"text":" protocol allows you to define credential providers external to the core library. The STS(Security Token Service) and Cognito Identity libraries both provide credential providers.","type":"text"}]},{"inlineContent":[{"type":"text","text":"STS extends "},{"code":"CredentialProviderFactory","type":"codeVoice"},{"text":" with five new ","type":"text"},{"code":"CredentialProviders","type":"codeVoice"},{"text":".","type":"text"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"codeVoice","code":"stsAssumeRole"},{"text":" for returning temporary credentials for a different role.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"code":"stsSAML","type":"codeVoice"},{"text":" for users authenticated via a SAML authentication response.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"code":"stsWebIdentity","type":"codeVoice"},{"text":" for users who have been authenticated in a mobile or web application with a web identity provider.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"codeVoice","code":"stsWebIdentityTokenFile"},{"type":"text","text":" for authenticating on EKS clusters. Set "},{"type":"codeVoice","code":"AWS_WEB_IDENTITY_TOKEN_FILE"},{"text":", ","type":"text"},{"type":"codeVoice","code":"AWS_ROLE_ARN"},{"type":"text","text":" and "},{"code":"AWS_ROLE_SESSION_NAME","type":"codeVoice"},{"text":" environment variables.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"codeVoice","code":"federationToken"},{"type":"text","text":" for providing temporary credentials to federated users."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"sessionToken"},{"type":"text","text":" for providing temporary credentials for the provided user with possible MFA authentication."}]}]}]},{"inlineContent":[{"type":"text","text":"See the AWS documentation on "},{"identifier":"https:\/\/docs.aws.amazon.com\/IAM\/latest\/UserGuide\/id_credentials_temp.html","type":"reference","isActive":true},{"text":".","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"CognitoIdentity adds two versions of "},{"code":"cognitoIdentity","type":"codeVoice"},{"text":" for users in a Cognito Identity Pool. The first version takes static identity details and the second you provide an object conforming to ","type":"text"},{"code":"IdentityProvider","type":"codeVoice"},{"text":" which will be used to provide identity details when they are required. Identities can be users in a Cognito User Pool or users who authenticate with external providers such as Facebook, Google and Apple. See the AWS documentation on ","type":"text"},{"type":"reference","identifier":"https:\/\/docs.aws.amazon.com\/cognito\/latest\/developerguide\/cognito-identity.html","isActive":true},{"text":".","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"For example, to use ","type":"text"},{"code":"STS.AssumeRole","type":"codeVoice"},{"type":"text","text":" to acquire new credentials you provide a request structure, credential provider to access original credentials and a region to run the STS commands in:"}],"type":"paragraph"},{"code":["import STS","","let request = STS.AssumeRoleRequest(roleArn: \"arn:aws:iam::000000000000:role\/Admin\", roleSessionName: \"session-name\")","let client = AWSClient(credentialProvider: .stsAssumeRole(request: request, credentialProvider: .ec2, region: .euwest1))"],"syntax":"swift","type":"codeListing"},{"type":"paragraph","inlineContent":[{"text":"Similarly you can setup a Cognito Identity credential provider as follows:","type":"text"}]},{"syntax":"swift","type":"codeListing","code":["import CognitoIdentity","","let credentialProvider: CredentialProviderFactory = .cognitoIdentity(","    identityPoolId: poolId,","    logins: [\"appleid.apple.com\": \"APPLETOKEN\"],","    region: .useast1",")","let client = AWSClient(credentialProvider: credentialProvider)"]}],"kind":"content"}],"references":{"https://docs.aws.amazon.com/codedeploy/latest/userguide/getting-started-create-iam-instance-profile.html":{"type":"link","titleInlineContent":[{"text":"setup an IAM role","type":"text"}],"url":"https:\/\/docs.aws.amazon.com\/codedeploy\/latest\/userguide\/getting-started-create-iam-instance-profile.html","title":"setup an IAM role","identifier":"https:\/\/docs.aws.amazon.com\/codedeploy\/latest\/userguide\/getting-started-create-iam-instance-profile.html"},"https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-identity.html":{"type":"link","titleInlineContent":[{"type":"text","text":"Cognito Identity Pools"}],"url":"https:\/\/docs.aws.amazon.com\/cognito\/latest\/developerguide\/cognito-identity.html","title":"Cognito Identity Pools","identifier":"https:\/\/docs.aws.amazon.com\/cognito\/latest\/developerguide\/cognito-identity.html"},"https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task-iam-roles.html#create_task_iam_policy_and_role":{"type":"link","titleInlineContent":[{"text":"setup an IAM role","type":"text"}],"url":"https:\/\/docs.aws.amazon.com\/AmazonECS\/latest\/developerguide\/task-iam-roles.html#create_task_iam_policy_and_role","title":"setup an IAM role","identifier":"https:\/\/docs.aws.amazon.com\/AmazonECS\/latest\/developerguide\/task-iam-roles.html#create_task_iam_policy_and_role"},"doc://codes.soto.soto-core/documentation/SotoCore":{"type":"topic","role":"collection","identifier":"doc:\/\/codes.soto.soto-core\/documentation\/SotoCore","kind":"symbol","abstract":[{"text":"The core framework for Soto, a Swift SDK for AWS","type":"text"}],"url":"\/documentation\/sotocore","title":"SotoCore"},"https://docs.aws.amazon.com/ses/latest/DeveloperGuide/create-shared-credentials-file.html":{"type":"link","titleInlineContent":[{"type":"text","text":"set shared credentials"}],"url":"https:\/\/docs.aws.amazon.com\/ses\/latest\/DeveloperGuide\/create-shared-credentials-file.html","title":"set shared credentials","identifier":"https:\/\/docs.aws.amazon.com\/ses\/latest\/DeveloperGuide\/create-shared-credentials-file.html"},"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp.html":{"type":"link","titleInlineContent":[{"text":"requesting temporary security credentials","type":"text"}],"url":"https:\/\/docs.aws.amazon.com\/IAM\/latest\/UserGuide\/id_credentials_temp.html","title":"requesting temporary security credentials","identifier":"https:\/\/docs.aws.amazon.com\/IAM\/latest\/UserGuide\/id_credentials_temp.html"},"doc://codes.soto.soto-core/documentation/SotoCore/ServiceObjects":{"type":"topic","abstract":[{"text":"Defining an AWS service.","type":"text"}],"url":"\/documentation\/sotocore\/serviceobjects","identifier":"doc:\/\/codes.soto.soto-core\/documentation\/SotoCore\/ServiceObjects","kind":"article","role":"article","title":"AWS Service Objects"}}}